// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
}

model User {
   id            String    @id @default(cuid())
   name          String?
   email         String    @unique
   emailVerified Boolean   @default(false)
   image         String?
   createdAt     DateTime  @default(now())
   updatedAt     DateTime  @updatedAt
   
   sessions      Session[]
   accounts      Account[]
 
   conversations Conversation[]
   
   @@map("user")
 }
 
 model Session {
   id        String   @id @default(cuid())
   userId    String
   token     String
   expiresAt DateTime
   ipAddress String?
   userAgent String?
   createdAt DateTime @default(now())
   updatedAt DateTime @updatedAt
   user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
   
   @@unique([token])
   @@map("session")
 }
 
 model Account {
   id           String    @id @default(cuid())
   userId       String
   accountId    String
   providerId   String
   accessToken  String?
   refreshToken String?
   idToken      String?
   accessTokenExpiresAt DateTime?
   refreshTokenExpiresAt DateTime?
   scope        String?
   password     String?
   createdAt    DateTime  @default(now())
   updatedAt    DateTime  @updatedAt
   user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
   
   @@map("account")
 }
 
 model Verification {
   id         String   @id @default(cuid())
   identifier String
   value      String
   expiresAt  DateTime
   createdAt  DateTime @default(now())
   updatedAt  DateTime @updatedAt
   
   @@map("verification")
 }

model Conversation {
  id              String    @id @default(cuid())
  userId          String
  title           String    @default("New Chat")
  model           String    @default("llama-3.3-70b-versatile")
  reasoningEffort String?
  reasoningFormat String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages Message[]

  @@index([userId])
  @@index([updatedAt])
}

model Message {
  id             String   @id @default(cuid())
  conversationId String
  role           String
  content        String   @default("")
  createdAt      DateTime @default(now())

  conversation    Conversation      @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  imageAttachments ImageAttachment[]

  @@index([conversationId])
  @@index([createdAt])
}

model ImageAttachment {
  id        String @id @default(cuid())
  messageId String
  url       String
  key       String?
  fileName  String
  mimeType  String

  message Message @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@index([messageId])
}
